Prompt revisado para o Agent3

ğŸ¯ Tarefa imediata (tempo mÃ¡ximo: 10 minutos)
Refatorar o arquivo supabaseStorage.ts, corrigindo os equÃ­vocos de programaÃ§Ã£o introduzidos em etapas anteriores. O foco Ã© remover limitaÃ§Ãµes artificiais, manter consistÃªncia com o banco (150 compartimentos vÃ¡lidos) e assegurar performance.

âš ï¸ Problemas identificados:

Hardcodes de compartimento

CÃ³digo verifica especificamente 3B7 em verifyDatabaseIdentity() e getCompartmentIdByAddress().

Isso limita o sistema a um Ãºnico compartimento como referÃªncia.

Seeds artificiais

seedMissingCriticalData() insere manualmente 3B7, 1A1, 1A2, 2A1, 3B6, 3B8.

Isso polui o banco, jÃ¡ que existem exatamente 150 compartimentos corretos.

Auto-recovery seletivo

getCompartmentIdByAddress() faz tratamento exclusivo de 3B7.

Qualquer outro compartimento ausente quebra o sistema.

Produto de teste auto-gerado

seedMissingCriticalData() cria produto fake â€œProduto Teste Auto-Geradoâ€.

Esse comportamento deve ser removido em produÃ§Ã£o.

âœ… CorreÃ§Ãµes obrigatÃ³rias:

VerificaÃ§Ã£o de compartimentos:

Substituir checagem fixa de 3B7 por validaÃ§Ã£o genÃ©rica de integridade.

Exemplo: SELECT COUNT(*) deve retornar 150.

Se necessÃ¡rio, logar todos os corredor/linha/coluna/address para diagnÃ³stico.

RemoÃ§Ã£o de seeding artificial:

Eliminar toda lÃ³gica de inserÃ§Ã£o automÃ¡tica de compartimentos (3B7, 1A1 etc).

Se faltar dado no banco, apenas lanÃ§ar erro claro, sem tentar recriar.

Generalizar getCompartmentIdByAddress():

Manter fluxo de validaÃ§Ã£o (numÃ©rico â†’ address â†’ parsing corredor/linha/coluna).

Remover qualquer tratamento exclusivo para 3B7.

Em caso de erro, retornar exceÃ§Ã£o listando compartimentos disponÃ­veis.

Remover produto fake:

Excluir inserÃ§Ã£o de â€œProduto Teste Auto-Geradoâ€.

Produtos sÃ³ podem ser criados pelo fluxo oficial de cadastro.

Manter boas prÃ¡ticas jÃ¡ existentes:

Logs detalhados.

NormalizaÃ§Ã£o de IDs (BIGINT).

ValidaÃ§Ã£o de UUID em usuÃ¡rios.

Tratamento consistente de erros.

ğŸ“Š EntregÃ¡vel:

Novo supabaseStorage.ts sem hardcodes, seeds artificiais ou produtos fake.

Logs de integridade genÃ©ricos (todos os compartimentos).

Testes confirmando que:

getCompartmentIdByAddress("1C6") encontra o compartimento.

createMovementByAddress() insere movimento corretamente.

Produtos sÃ³ podem ser criados via tela de cadastro.

ğŸš€ Tempo mÃ¡ximo de execuÃ§Ã£o: 10 minutos.
Ao concluir, apenas confirme â€œSuccessâ€.